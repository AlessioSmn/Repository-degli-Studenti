<!DOCTYPE html>
<html lang="it">
<head>
	<meta charset="utf-8">
      <title>Repository studenti</title>
      <link rel="stylesheet" type="text/CSS" href="css/themes/dark.css" id="theme">
      <link rel="stylesheet" type="text/CSS" href="css/general.css">
      <link rel="stylesheet" type="text/CSS" href="css/header.css">
      <link rel="stylesheet" type="text/CSS" href="css/navbar.css">
      <link rel="stylesheet" type="text/CSS" href="css/footer.css">
      <link rel="icon" type="image/ICO" href="media/.ico/cherubino_pant541.ico">
      <script src="js/theme/themeControl.js"></script>
      <script src="js/logControl/logout.js"></script>
      <script>
            function saveTheme(event){
                  event.preventDefault();

                  const form = document.getElementById('themeForm2');

                  // Salvo in cache un array contenente le varibili CSS per i vari colori
                  const customTheme = {
                        '--bgColor_light': form.elements['bgColor_light'].value,
                        '--bgColor': form.elements['bgColor'].value,
                        '--bgColor_dark': form.elements['bgColor_dark'].value,

                        '--foreColor_light': form.elements['foreColor_light'].value,
                        '--foreColor': form.elements['foreColor'].value,
                        '--foreColor_dark': form.elements['foreColor_dark'].value,

                        '--primary_light': form.elements['primary_light'].value,
                        '--primary': form.elements['primary'].value,
                        '--primary_dark': form.elements['primary_dark'].value,

                        '--secondary_light': form.elements['secondary_light'].value,
                        '--secondary': form.elements['secondary'].value,
                        '--secondary_dark': form.elements['secondary_dark'].value,
                  };

                  // Salvo l'array serializzato in cache 
                  localStorage.setItem('customThemeInfo', JSON.stringify(customTheme));
            }
            function useTheme(event) {
                  event.preventDefault();
                  setTheme(CUSTOM_THEME);
            }
      </script>
      <style>
            table{
                  border-collapse: collapse;
            }
            th:nth-child(2),
            th:nth-child(6){
                  width: 10px;
            }
            th:nth-child(3),
            th:nth-child(4),
            th:nth-child(5){
                  width: 200px;
            }
            input[type="checkbox"]{
                  height: 20px;
                  width: 20px;
            }
            input[type="color"]{
                  width: 100%;
                  height: 100px;
                  margin: 0px;
                  padding: 0px;
                  outline: none; 
                  border: 0px;
                  background-color: transparent;
            }
      </style>
</head>
<body>
      <header>
            <h1>PAGINA CUSTOM FONT</h1>
      </header>

      <!-- Barra di navigazione del sito -->
      <nav>
            <a href="index.php" class="navbar-main-element"><div><span>Home</span></div></a>
            <div class="navbar-main-element navbar-dropdown-main">
                  <span>Accesso<span>
                  <div class="navbar-dropdown-container">
                        <a class="navbar-dropdown-option" href="login.php">Login</a>
                        <a class="navbar-dropdown-option" href="signup.php">Registrati</a>
                        <a class="navbar-dropdown-option" onclick="logout()">Logout</a>
                  </div>
            </div>
            <div class="navbar-main-element navbar-dropdown-main">
                  <span>Area personale<span>
                  <div class="navbar-dropdown-container">
                        <a href="personal.php" class="navbar-dropdown-option">Area personale</a>
                        <a href="uploaddocument.php" class="navbar-dropdown-option">Upload</a>
                        <a href="#" class="navbar-dropdown-option current-page">Tema custom</a>
                  </div>
            </div>
            <a href="search.php" class="navbar-main-element"><div><span>Cerca</span></div></a>
            <a href="statistics.php" class="navbar-main-element"><div><span>Statistiche</span></div></a>
            <a href="manual.html" class="navbar-main-element"><div><span>Manuale</span></div></a>
            <div class="navbar-main-element floating" onclick="logout()"><span>Logout</span></div>
            <div class="navbar-main-element navbar-dropdown-main floating">
                  <span>Tema<span>
                  <div class="navbar-dropdown-container">
                        <a class="navbar-dropdown-option" onclick="setTheme('dark')">Scuro</a>
                        <a class="navbar-dropdown-option" onclick="setTheme('grey')">Grigio</a>
                        <a class="navbar-dropdown-option" onclick="setTheme('light')">Chiaro</a>
                        <a class="navbar-dropdown-option" onclick="setTheme('pantone')">Pantone</a>
                        <a class="navbar-dropdown-option" onclick="setTheme('custom')">Neon</a>
                  </div>
            </div>
      </nav>

      <section>
            <form id="themeForm2">
                  <table>
                        <tr>
                              <th>-</th>
                              <th>Blocca il colore chiaro</th>
                              <th>Versione chiara</th>
                              <th>Colore</th>
                              <th>Versione scura</th>
                              <th>Blocca il colore scuro</th>
                              <th>Slider</th>
                        </tr>
                        <tr>
                              <td><label>Colore dello sfondo</label></td>
                              <td><input type="checkbox"/></td>
                              <td><input type="color" value="#e0ffff" name="bgColor_light"/></td>
                              <td><input type="color" value="#b7efef" name="bgColor" onchange="updateColor(this)"/></td>
                              <td><input type="color" value="#90dfdf" name="bgColor_dark"/></td>
                              <td><input type="checkbox"/></td>
                              <td><input type="range" value="50" min="-100" max="100" oninput="updateColor(this)"/></td>
                        </tr>
                        <tr>
                              <td><label>Colore del testo</label></td>
                              <td><input type="checkbox"/></td>
                              <td><input type="color" value="#500050" name="foreColor_light"/></td>
                              <td><input type="color" value="#200020" name="foreColor" onchange="updateColor(this)"/></td>
                              <td><input type="color" value="#000000" name="foreColor_dark"/></td>
                              <td><input type="checkbox"/></td>
                              <td><input type="range" value="50" min="-100" max="100" oninput="updateColor(this)"/></td>
                        </tr>
                        <tr>
                              <td><label>Colore primario</label></td>
                              <td><input type="checkbox"/></td>
                              <td><input type="color" value="#fff080" name="primary_light"/></td>
                              <td><input type="color" value="#ffe030" name="primary" onchange="updateColor(this)"/></td>
                              <td><input type="color" value="#f0b020" name="primary_dark"/></td>
                              <td><input type="checkbox"/></td>
                              <td><input type="range" value="50" min="-100" max="100" oninput="updateColor(this)"/></td>
                        </tr>
                        <tr>
                              <td><label>Colore secondario</label></td>
                              <td><input type="checkbox"/></td>
                              <td><input type="color" value="#ff70fe" name="secondary_light"/></td>
                              <td><input type="color" value="#f040f0" name="secondary" onchange="updateColor(this)"/></td>
                              <td><input type="color" value="#e020d8" name="secondary_dark"/></td>
                              <td><input type="checkbox"/></td>
                              <td><input type="range" value="50" min="-100" max="100" oninput="updateColor(this)"/></td>
                        </tr>
                  </table>
                  <button onclick="saveTheme(event)">Salva tema</button>
                  <button onclick="useTheme(event)">Utlizza tema</button>
            </form>
      </section>

      <section>
            ESEMPIO DI PAGINA
      </section>

      <footer>
            <div class="left-section">
                  <span>Autore</span> <span>Alessio Simoncini</span><br>
                  <span>Materia</span> <span>Progettazione WEB</span><br>
                  <span>Codice</span> <span>080II</span>
                  <hr>
                  <span>Corso di studio</span> <span>CdS Ingegneria Informatica</span><br>
                  <span>Dipartimento</span> <span>Dipartimento di Ingegneria dell'informazione</span><br>
                  <span>Scuola</span> <span>Scuola di Ingegneria</span><br>
                  <span>Universit&agrave;</span> <span>Universit&agrave; di Pisa</span><br>
                  <span>Indirizzo</span> <address>Lungarno Pacinotti 43, 56126 Pisa</address>
            </div>
            <div class="right-section">
                  <img class="company-logo" id="footerUnipiLogo" src="media/.ico/cherubino_white.ico">
            </div>
      </footer>
      
      <script>
            
            /**
             * Imposta i valori degli input dei colori al valore impostato, se presente
             */
            function setCurrentCustomTheme() {
                  // Controllo che sia stato definito un tema custom
                  const storedCustomTheme = localStorage.getItem('customThemeInfo');

                  // in tal caso scorro tutte le regole
                  if (storedCustomTheme) {
                        // Deserializzo il tema in un array di variabili css
                        const customTheme = JSON.parse(storedCustomTheme);

                        // Per ogni variabile cerco il corrispondente input
                        Object.keys(customTheme).forEach(variable => {

                              // cerco l'elemento input con il nome corrispondente (tolgo però il '--' quando cerco il nome)
                              const input = document.querySelector(`[name="${variable.replace('--', '')}"]`);

                              // imposto il value corrente
                              if (input) input.value = customTheme[variable];
                        });
                  }
            }

            const lightLockIndex = 1;
            const lighterColorIndex = 2;
            const baseColorIndex = 3;
            const darkerColorIndex = 4;
            const darkLockIndex = 5;
            const sliderIndex = 6;

            /**
             * @param {HTMLElement} CallerElement
             */
            function updateColor(CallerElement){
                  // Accedo ai 'fratelli' dell'elemento chiamante
                  let tableRow = CallerElement.parentNode.parentNode;
                  let tableCells = Array.from(tableRow.children);

                  // Riferimento ai singoli fratelli, per comodità
                  let baseColor = Array.from(tableCells[baseColorIndex].children)[0];
                  let shadeSlider = Array.from(tableCells[sliderIndex].children)[0];     
                  // Colore base impostato e percentuale di scostamento da questo      
                  let newBaseColor = baseColor.value;
                  let percentage = shadeSlider.value;    

                  // Controllo se il colore chiaro può variare con il colore base
                  let lightColorLock = Array.from(tableCells[lightLockIndex].children)[0];
                  if(!lightColorLock.checked){
                        let lighterColor = Array.from(tableCells[lighterColorIndex].children)[0];  
                        lighterColor.value = shadeColor(newBaseColor, +percentage);
                  }

                  // Controllo se il colore chiaro può variare con il colore base
                  let darkColorLock = Array.from(tableCells[darkLockIndex].children)[0];
                  if(!darkColorLock.checked){
                        let darkerColor = Array.from(tableCells[darkerColorIndex].children)[0];
                        darkerColor.value = shadeColor(newBaseColor, -percentage);
                  }
            }

            function shadeColor(color, percent) {

                  let finalColor = '#';

                  // Ciclo su R, G e B
                  for(let index = 1; index < 7; index += 2){

                        // Prendo le due cifre esadecimali
                        let colorComponent = parseInt(color.substring(index, index + 2), 16);

                        // Scalo la componente
                        let shadedComponent = colorComponent * (100 + percent) / 100;

                        // Controllo che sia minnore o uguale a 255
                        shadedComponent = Math.min(shadedComponent, 255);

                        // Arrotondo ad intero
                        shadedComponent = Math.round(shadedComponent);

                        // Converto in esadecimale, eventualmente mettendo uno 0 per rimanere su due cifre
                        let hexaComponent = '';
                        if(shadedComponent < 16) hexaComponent += '0';
                        hexaComponent += shadedComponent.toString(16);

                        finalColor += hexaComponent;
                  }

                  return finalColor;
            }

            setCurrentCustomTheme();
      </script>
</body>
</html>