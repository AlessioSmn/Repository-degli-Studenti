<!DOCTYPE html>
<html lang="it">
<head>
	<meta charset="utf-8">
      <title>Repository studenti</title>
      <link rel="stylesheet" type="text/CSS" href="css/themes/dark.css" id="theme">
      <link rel="stylesheet" type="text/CSS" href="css/general.css">
      <link rel="stylesheet" type="text/CSS" href="css/header.css">
      <link rel="stylesheet" type="text/CSS" href="css/navbar.css">
      <link rel="stylesheet" type="text/CSS" href="css/footer.css">
      <link rel="icon" type="image/ICO" href="media/.ico/cherubino_pant541.ico">
      <script src="js/theme/themeControl.js"></script>
      <script src="js/logControl/logout.js"></script>
      <script>
            function saveTheme(event){
                  event.preventDefault();

                  const form = document.getElementById('themeForm2');

                  // Salvo in cache un array contenente le varibili CSS per i vari colori
                  const customTheme = {
                        '--bgColor_light': form.elements['bgColor_light'].value,
                        '--bgColor': form.elements['bgColor'].value,
                        '--bgColor_dark': form.elements['bgColor_dark'].value,

                        '--foreColor_light': form.elements['foreColor_light'].value,
                        '--foreColor': form.elements['foreColor'].value,
                        '--foreColor_dark': form.elements['foreColor_dark'].value,

                        '--primary_light': form.elements['primary_light'].value,
                        '--primary': form.elements['primary'].value,
                        '--primary_dark': form.elements['primary_dark'].value,

                        '--secondary_light': form.elements['secondary_light'].value,
                        '--secondary': form.elements['secondary'].value,
                        '--secondary_dark': form.elements['secondary_dark'].value,
                  };

                  console.log(customTheme);

                  // Salvo l'array serializzato in cache 
                  localStorage.setItem('customThemeInfo', JSON.stringify(customTheme));
            }
            function useTheme(event) {
                  event.preventDefault();
                  setTheme(CUSTOM_THEME);
            }
      </script>
      <style>
            input[type="color"]{
                  width: 200px;
                  height: 50px;
            }
      </style>
</head>
<body>
      <header>
            <h1>PAGINA CUSTOM FONT</h1>
      </header>

      <nav>
            <a href="index.php" class="navbar-main-element">Home</a>
            <div class="navbar-main-element navbar-dropdown-main">
                  <a href="personal.php" class="navbar-main-element"><div>Area personale</div></a>
                  <div class="navbar-dropdown-container" style="margin-top: 50px;">
                        <a href="customize.html" class="navbar-dropdown-option current-page">Tema custom</a>
                  </div>
            </div>
            <a href="search.php" class="navbar-main-element">Cerca</a>
            <a href="login.php" class="navbar-main-element">Login</a>
            <a href="signup.php" class="navbar-main-element">Registrati</a>
            <a href="manual.html" class="navbar-main-element">Manuale</a>
            <a href="statistics.php" class="navbar-main-element">Doc-</a>
            <div class="navbar-main-element navbar-dropdown-main floating">
                  <span>Tema<span>
                  <div class="navbar-dropdown-container">
                        <a class="navbar-dropdown-option" onclick="setTheme('dark')">Scuro</a>
                        <a class="navbar-dropdown-option" onclick="setTheme('grey')">Grigio</a>
                        <a class="navbar-dropdown-option" onclick="setTheme('light')">Chiaro</a>
                        <a class="navbar-dropdown-option" onclick="setTheme('pantone')">Pantone</a>
                        <a class="navbar-dropdown-option" onclick="setTheme('custom')">Neon</a>
                        <a class="navbar-dropdown-option" onclick="setTheme(CUSTOM_THEME)">Custom</a>
                  </div>
            </div>
            <div class="navbar-main-element floating" onclick="logout()"><span>&#11199;</span> Logout</div>
      </nav>

      <section>
            <form id="themeForm2">
                  <table>
                        <tr>
                              <td><label>Colore dello sfondo</label></td>
                              <td><input type="color" value="#ffffff" name="bgColor_light"/></td>
                              <td><input type="color" value="#efefef" name="bgColor" onchange="updateColor(this)"/></td>
                              <td><input type="color" value="#dfdfdf" name="bgColor_dark"/></td>
                              <td><input type="range" value="50" min="-100" max="100" oninput="updateColor(this)"/></td>
                        </tr>
                        <tr>
                              <td><label>Colore del testo</label></td>
                              <td><input type="color" value="#000000" name="foreColor_light"/></td>
                              <td><input type="color" value="#ff0000" name="foreColor" onchange="updateColor(this)"/></td>
                              <td><input type="color" value="#202020" name="foreColor_dark"/></td>
                              <td><input type="range" value="50" min="-100" max="100" oninput="updateColor(this)"/></td>
                        </tr>
                        <tr>
                              <td><label>Colore primario</label></td>
                              <td><input type="color" value="#000000" name="primary_light"/></td>
                              <td><input type="color" value="#00ff00" name="primary" onchange="updateColor(this)"/></td>
                              <td><input type="color" value="#202020" name="primary_dark"/></td>
                              <td><input type="range" value="50" min="-100" max="100" oninput="updateColor(this)"/></td>
                        </tr>
                        <tr>
                              <td><label>Colore secondario</label></td>
                              <td><input type="color" value="#000000" name="secondary_light"/></td>
                              <td><input type="color" value="#0000ff" name="secondary" onchange="updateColor(this)"/></td>
                              <td><input type="color" value="#202020" name="secondary_dark"/></td>
                              <td><input type="range" value="50" min="-100" max="100" oninput="updateColor(this)"/></td>
                        </tr>
                  </table>
                  <button onclick="saveTheme(event)">Salva tema</button>
                  <button onclick="useTheme(event)">Utlizza tema</button>
            </form>
      </section>

      <section>
            ESEMPIO DI PAGINA
      </section>

      <footer>footer</footer>
      <script>
            
            /**
             * Imposta i valori degli input dei colori al valore impostato, se presente
             */
            function setCurrentCustomTheme() {
                  // Controllo che sia stato definito un tema custom
                  const storedCustomTheme = localStorage.getItem('customThemeInfo');

                  // in tal caso scorro tutte le regole
                  if (storedCustomTheme) {
                        // Deserializzo il tema in un array di variabili css
                        const customTheme = JSON.parse(storedCustomTheme);

                        // Per ogni variabile cerco il corrispondente input
                        Object.keys(customTheme).forEach(variable => {

                              // cerco l'elemento input con il nome corrispondente (tolgo per√≤ il '--' quando cerco il nome)
                              const input = document.querySelector(`[name="${variable.replace('--', '')}"]`);

                              // imposto il value corrente
                              if (input) input.value = customTheme[variable];
                        });
                  }
            }

            /**
             * @param {HTMLElement} CallerElement
             */
            function updateColor(CallerElement){
                  let tableRow = CallerElement.parentNode.parentNode;
                  let tableCells = Array.from(tableRow.children);

                  let lighterColor = Array.from(tableCells[1].children)[0];
                  let baseColor = Array.from(tableCells[2].children)[0];
                  let darkerColor = Array.from(tableCells[3].children)[0];
                  let shadeSlider = Array.from(tableCells[4].children)[0];
                  
                  let perc = shadeSlider.value;                  
                  let newColor = baseColor.value;
                  lighterColor.value = shadeColor(newColor, +shadeSlider.value);
                  darkerColor.value = shadeColor(newColor, -shadeSlider.value);
            }

            function shadeColor(color, percent) {

                  var R = parseInt(color.substring(1,3),16);
                  var G = parseInt(color.substring(3,5),16);
                  var B = parseInt(color.substring(5,7),16);

                  R = parseInt(R * (100 + percent) / 100);
                  G = parseInt(G * (100 + percent) / 100);
                  B = parseInt(B * (100 + percent) / 100);

                  R = (R<255)?R:255;  
                  G = (G<255)?G:255;  
                  B = (B<255)?B:255;  

                  R = Math.round(R)
                  G = Math.round(G)
                  B = Math.round(B)

                  var RR = ((R.toString(16).length==1)?"0"+R.toString(16):R.toString(16));
                  var GG = ((G.toString(16).length==1)?"0"+G.toString(16):G.toString(16));
                  var BB = ((B.toString(16).length==1)?"0"+B.toString(16):B.toString(16));

                  return "#"+RR+GG+BB;
            }

            setCurrentCustomTheme();
      </script>
</body>
</html>